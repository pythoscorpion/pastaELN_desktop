"use strict";

/* Common functions for js- and python code
  ONLY Written here in js. python functions are obtained by automatic translation
  PythonFolder: execute 'asTools.py'
*/
function uuidv4() {
  // since py and js could use same document creation: they have to create similar shaped uuids
  // from: https://stackoverflow.com/questions/105034/create-guid-uuid-in-javascript
  // - used internal in this file
  return 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'.replace(/[x]/g, function (c) {
    var r = Math.random() * 16 | 0,
        v = c === 'x' ? r : r & (0x3 | 0x8);
    return v.toString(16);
  });
}

function fillDocBeforeCreate(data, docType) {
  /**
   *  Fill the data before submission to database with common data
   * - type, project, childs
   * - separate comment into tags, fields
   * - create id if needed
   *
   * used in backend.py and Store.js
   *
   * Args:
   *    data: document to save
   *    docType: type of document, e.g. project
   *
   * Returns:
   *    document
   */
  const protectedKeys = ['comment', 'tags', 'image']; //Handle the important entries: -type, _id, -date, -branch

  if (!data['-type']) {
    data['-type'] = [docType];
  }

  if (typeof data['-type'] === 'string' || data['-type'] instanceof String) {
    data['-type'] = data['-type'].split('/');
  }

  if (!data['_id']) {
    //if new (if not update): create new id
    var prefix = docType[0] == 'x' ? 'x' : docType[0][0];
    data['_id'] = prefix + '-' + uuidv4();
  }

  const now = new Date();
  data['-date'] = now.toISOString();

  if (!data['-branch']) {
    data['-branch'] = [{
      'stack': [],
      'path': null
    }];
  } //separate comment into tags and fields
  //these tags are lost: '#d': too short; '#3tag': starts with number
  //  Note: should distinguish between comment==null vs. comment==undefined: but not possible with js2py


  if (!data['comment']) data['comment'] = '';
  if (!data['tags']) data['tags'] = [];
  var rating = data.comment.match(/#\d/); //one character following #

  if (rating === null) {
    rating = [];
  }

  var otherTags = data['comment'].match(/(^|\s)#{1}[a-zA-Z][\w]+/g);

  if (otherTags === null) {
    otherTags = [];
  }

  data['tags'] = rating.concat(data['tags']).concat(otherTags);
  data['comment'] = data['comment'].replace(/(^|\s)#{1}[\w]+/g, ' ');
  const fields = data['comment'].match(/:[\S]+:[\S]+:/g);

  if (fields != null) {
    fields.map(function (item) {
      const aList = item.split(':');
      if (data[aList[1]]) //do not add if item already exists
        return;

      if (isNaN(aList[2])) {
        return data[aList[1]] = aList[2];
      } else {
        return data[aList[1]] = +aList[2];
      }
    });
  } // clean the comments


  data['comment'] = data['comment'].replace(/:[\S]+:[\S]+:/g, ''); //remove :field:data: information

  var text = data['comment'].split('\n');
  data['comment'] = '';

  for (var i = 0; i < text.length; i++) {
    const line = text[i];
    var initSpaces = line.search(/\S|$/);

    for (var prefixJ = ''; prefixJ.length < Math.round(initSpaces / 2) * 2; prefixJ += ' '); //str.repeat(int) does not work for some reason


    data['comment'] += prefixJ + line.trim() + '\n'; //do not replace spaces inside the line
  }

  data['comment'] = data['comment'].substring(0, data['comment'].length - 1);

  if (typeof data['tags'] === 'string' || data['tags'] instanceof String) {
    data['tags'] = data['tags'].split(' ');
  }

  data['tags'] = data['tags'].map(function (v) {
    return v.trim();
  }); //individual verification of documents

  if (data['-type'][0] === 'sample') {
    if (!data.qrCode) {
      data['qrCode'] = [];
    }

    if (typeof data.qrCode === 'string' || data.qrCode instanceof String) {
      data.qrCode = data.qrCode.split(' ');
    }
  }

  if (data['-type'][0] === 'measurement') {
    if (!data.image) {
      data['image'] = '';
    }

    if (!data.shasum) {
      data['shasum'] = '';
    }
  } //cleaning at end of all changes


  const keys = Object.keys(data);
  keys.map(function (key) {
    if (typeof data[key] === 'string' || data[key] instanceof String) {
      if (data[key] == '' && protectedKeys.indexOf(key) == -1) {
        delete data[key];
      } else {
        data[key] = data[key].trim();
      }
    }
  });
  return data;
}

function ontology2Labels(ontology, tableFormat) {
  /**
   * Extract labels and create lists of docType,docLabel pair
   * - used in Store.js and database.py
   * - docLabel is the plural human-readable form of the docType
   * - docType is the single-case noun
   *
   * Args:
   *    ontology: ontology
   *    tableFormat: tableFormat branch from .pastaELN.json
   *
   * Returns:
   *    dictionary: dataDict, hierarchyDict
   */
  var dataDict = {};
  var hierarchyDict = {};
  Object.keys(ontology).map(function (key) {
    if (key == '_id' || key == '_rev') return;
    var label = null;

    if (key in tableFormat && '-label-' in tableFormat[key]) {
      //use from tableFormat
      label = tableFormat[key]['-label-'];
    } else if (key[0] == 'x') {
      //use default structural elements
      label = ['Projects', 'Tasks', 'Subtasks', 'Subsubtasks'][key[1]];
    } else {
      //default system  sample->Samples
      label = key[0].toUpperCase() + key.slice(1) + 's';
    }

    if (key[0] == 'x') hierarchyDict[key] = label;else dataDict[key] = label;
    return;
  });
  return {
    'dataDict': dataDict,
    'hierarchyDict': hierarchyDict
  };
}

function hierarchy2String(data, addID, callback, detail, magicTags) {
  /**
   * Convert dictionary for hierarchical tree into a string
   * - used in Store.js and backend.js
   *
   * Args:
   *    data: dictionary of entries for this project
   *    addID: add doc-Id to output
   *    callBack: callback function to get documents from database
   *    detail: amount of detail to be given
   *    magicTags: tags to be moved to the front; order important..last are added to front
   *
   * Returns:
   *    org-mode string of hierarchy
   */
  var dataList = []; // arrange value items (hierarchy) into order that can be used for sorting

  const keys = Object.keys(data);
  var hierString = null;

  for (var i = 0; i < keys.length; i++) {
    const key = keys[i];
    const value = data[key];

    if (value[0] === key) {
      //project: simple hierarchy
      hierString = key;
    } else {
      //else: complicated re-structuring
      var hierarchyIDs = value[0].split(' ');
      hierString = hierarchyIDs[0]; // initialize string

      for (var j = 1; j < hierarchyIDs.length; j++) {
        const id = hierarchyIDs[j];
        var childNum = 0;
        if (id in data) childNum = data[id][1];

        if (childNum > 9999) {
          console.log('**ERROR** commonTools:ChildNUM>9999 **ERROR** ' + key);
        }

        hierString += ' ' + ('00' + childNum).substr(-3) + ' ' + id; //childNum-ID(padded with 0) ID
      } //hierarchy = hierString; //+' '+value[1].toString();

    } // add to data list


    dataList.push({
      hierarchy: hierString,
      label: value.slice(2)
    });
  } // sorting


  function compare(a, b) {
    if (a.hierarchy > b.hierarchy) return 1;else return -1;
  }

  dataList.sort(compare); //console.log(dataList);
  //nativeView, addID=False, callback=None, detail='none', magicTags=None
  // use sorted data list and create string

  var outString = dataList.map(function (item) {
    const hierarchyArray = item.hierarchy.split(' ');
    const spaces = hierarchyArray.length / 2 - 0.5;

    for (var prefix = ''; prefix.length <= spaces; prefix += '*'); //str.repeat(int) does not work for some reason


    if (addID === true) {
      var partString = item.label[1];
      var docID = hierarchyArray[hierarchyArray.length - 1];
      partString += '||' + docID;

      if (typeof callback === 'function') {
        var doc = callback(docID);

        if (detail === 'all') {
          for (var i = 0; i < doc['-branch'].length; i++) {
            partString += '\nPath: ' + doc['-branch'][i].path;
          }

          partString += '\nInheritance: ';

          for (var i1 = 0; i1 < doc['-branch'].length; i1++) {
            partString += doc['-branch'][i1].stack + ' ';
          }
        }

        if (doc['-type'] == ['x', 'project']) {
          partString += '\nObjective: ' + doc.objective;
        }

        for (var i2 = 0; i2 < magicTags.length; i2++) {
          if (doc.tags.indexOf('#' + magicTags[i2]) > -1) {
            prefix = prefix + ' ' + magicTags[i2];

            for (var i3 = 0; i3 < doc.tags.length; i3++) {
              if (doc.tags[i3] === '#' + magicTags[i2]) {
                doc.tags.splice(i, 1);
                i--;
              }
            }
          }
        }

        partString += '\nTags: ' + doc.tags.join(' ') + '\n' + doc.comment;
      }

      partString = prefix + ' ' + partString;
    } else {
      partString = prefix + ' ' + item.label[0] + ': ' + item.label[1];
    }

    return partString;
  }); // end of mapping

  return outString.join('\n');
}

function editString2Docs(text, magicTags) {
  /**
   * Org-Mode string into list of documents
   * - used in backend.py
   *
   * Args:
   *    text: org-mode string incl. docIDs
   *    magicTags: tags to be moved to the front; order important..last are added to front
   *
   * Returns:
   *    list of documents, document = list of '-new-',title,objective,tags,comment,docID,docType
   */
  var docs = [];
  var objective = null,
      tags = null,
      comment = null,
      title = '',
      docID = '',
      docType = '';
  text = text.split('\n');

  for (var i = 0; i < text.length; i++) {
    const line = text[i];

    if (line.substring(0, 2) === '* ' || line.substring(0, 3) === '** ' || line.substring(0, 4) === '*** ' || line.substring(0, 5) === '**** ' || line.substring(0, 6) === '***** ' || line.substring(0, 7) === '****** ') {
      // finish this entry
      if (comment) comment = comment.trim(); //remove trailing /n

      var docI = {
        '-name': title,
        tags: tags,
        comment: comment,
        _id: docID,
        '-type': docType
      };
      if (objective) docI['objective'] = objective;

      if (title == '-delete-' && docID != '') {
        docI['edit'] = '-delete-';
      } else {
        if (docID == '') docI['edit'] = '-new-';else docI['edit'] = '-edit-';
      }

      if (docID != '' || title != '') docs.push(docI); // reset variables

      objective = null;
      tags = null;
      comment = null;
      title = '';
      docID = '';
      docType = ''; // fill new set

      const parts = line.split('||');
      title = parts[0].split(' ').slice(1).join(' ').trim();

      for (var j = magicTags.length - 1; j >= 0; j--) {
        if (title.substring(0, 4) === magicTags[j]) {
          title = title.slice(magicTags[j].length + 1);
          tags += '#' + magicTags[j] + ' ';
        }
      }

      if (tags) tags = tags.trim();
      if (parts.length > 1) docID = parts[parts.length - 1];
      docType = line.split(' ')[0].length - 1; //number of * at the beginning of line
    } else if (line.substring(0, 10) === 'Objective:') objective = line.substring(10, line.length).trim();else if (line.substring(0, 5) === 'Tags:') tags = tags === null ? line.substring(5, line.length).trim() : tags + line.substring(5, line.length).trim();else if (!/\|\|\w-/.test(line)) comment = comment === null ? line + '\n' : comment + line + '\n';
  } // after all done, process last document


  if (comment) comment = comment.trim();
  docI = {
    '-name': title,
    tags: tags,
    comment: comment,
    _id: docID,
    '-type': docType
  };
  if (objective) docI['objective'] = objective;

  if (title == '-delete-' && docID != '') {
    docI['edit'] = '-delete-';
  } else {
    if (docID == '') docI['edit'] = '-new-';else docI['edit'] = '-edit-';
  }

  docs.push(docI);
  return docs;
}

function getChildren(data, docID) {
  /**
   * Get direct children of document
   * - used in backend.py
   *
   * Args:
   *    data: hierarchical tree in org-mode format
   *    docID: id for parent
   *
   * Returns:
   *    dictionary of names and ids of direct first-order children
   */
  var names = [];
  var ids = [];
  var saveLine = false;
  var numStarsParent = -1;
  const lines = data.split('\n');

  for (var i = 0; i < lines.length; i++) {
    const items = lines[i].split('||');

    if (saveLine) {
      const nStars = items[0].split(' ')[0].length;
      if (nStars === numStarsParent) break;

      if (nStars === numStarsParent + 1) {
        ids.push(items[1]);
        names.push(items[0].substring(numStarsParent + 2));
      }
    }

    if (items[1] === docID) {
      if (items[0][0] === '*') {
        numStarsParent = items[0].split(' ').length;
      } else {
        numStarsParent = 0;
      }

      saveLine = true;
    }
  }

  return {
    names: names,
    ids: ids
  };
}

function camelCase(str) {
  /**
   * Produce camelCase from normal string
   *  used in backend.py
   */
  var outString = str.replace(/(?:^\w|[A-Z]|\b\w|\s+)/g, function (match) {
    if (/\s+/.test(match)) return ''; // for white spaces

    return match.toUpperCase(); // else, incl. numbers
  });
  outString = outString.replace(/\W/g, '');
  return outString;
}

exports.fillDocBeforeCreate = fillDocBeforeCreate;
exports.ontology2Labels = ontology2Labels;
exports.hierarchy2String = hierarchy2String;
exports.editString2Docs = editString2Docs;
exports.getChildren = getChildren;
exports.camelCase = camelCase;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlbmRlcmVyL2NvbW1vblRvb2xzLmpzIl0sIm5hbWVzIjpbInV1aWR2NCIsInJlcGxhY2UiLCJjIiwiciIsIk1hdGgiLCJyYW5kb20iLCJ2IiwidG9TdHJpbmciLCJmaWxsRG9jQmVmb3JlQ3JlYXRlIiwiZGF0YSIsImRvY1R5cGUiLCJwcm90ZWN0ZWRLZXlzIiwiU3RyaW5nIiwic3BsaXQiLCJwcmVmaXgiLCJub3ciLCJEYXRlIiwidG9JU09TdHJpbmciLCJyYXRpbmciLCJjb21tZW50IiwibWF0Y2giLCJvdGhlclRhZ3MiLCJjb25jYXQiLCJmaWVsZHMiLCJtYXAiLCJpdGVtIiwiYUxpc3QiLCJpc05hTiIsInRleHQiLCJpIiwibGVuZ3RoIiwibGluZSIsImluaXRTcGFjZXMiLCJzZWFyY2giLCJwcmVmaXhKIiwicm91bmQiLCJ0cmltIiwic3Vic3RyaW5nIiwicXJDb2RlIiwiaW1hZ2UiLCJzaGFzdW0iLCJrZXlzIiwiT2JqZWN0Iiwia2V5IiwiaW5kZXhPZiIsIm9udG9sb2d5MkxhYmVscyIsIm9udG9sb2d5IiwidGFibGVGb3JtYXQiLCJkYXRhRGljdCIsImhpZXJhcmNoeURpY3QiLCJsYWJlbCIsInRvVXBwZXJDYXNlIiwic2xpY2UiLCJoaWVyYXJjaHkyU3RyaW5nIiwiYWRkSUQiLCJjYWxsYmFjayIsImRldGFpbCIsIm1hZ2ljVGFncyIsImRhdGFMaXN0IiwiaGllclN0cmluZyIsInZhbHVlIiwiaGllcmFyY2h5SURzIiwiaiIsImlkIiwiY2hpbGROdW0iLCJjb25zb2xlIiwibG9nIiwic3Vic3RyIiwicHVzaCIsImhpZXJhcmNoeSIsImNvbXBhcmUiLCJhIiwiYiIsInNvcnQiLCJvdXRTdHJpbmciLCJoaWVyYXJjaHlBcnJheSIsInNwYWNlcyIsInBhcnRTdHJpbmciLCJkb2NJRCIsImRvYyIsInBhdGgiLCJpMSIsInN0YWNrIiwib2JqZWN0aXZlIiwiaTIiLCJ0YWdzIiwiaTMiLCJzcGxpY2UiLCJqb2luIiwiZWRpdFN0cmluZzJEb2NzIiwiZG9jcyIsInRpdGxlIiwiZG9jSSIsIl9pZCIsInBhcnRzIiwidGVzdCIsImdldENoaWxkcmVuIiwibmFtZXMiLCJpZHMiLCJzYXZlTGluZSIsIm51bVN0YXJzUGFyZW50IiwibGluZXMiLCJpdGVtcyIsIm5TdGFycyIsImNhbWVsQ2FzZSIsInN0ciIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFFQSxTQUFTQSxNQUFULEdBQWtCO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBLFNBQU8sbUNBQW1DQyxPQUFuQyxDQUEyQyxNQUEzQyxFQUFtRCxVQUFTQyxDQUFULEVBQVk7QUFDcEUsUUFBSUMsQ0FBQyxHQUFHQyxJQUFJLENBQUNDLE1BQUwsS0FBZ0IsRUFBaEIsR0FBcUIsQ0FBN0I7QUFBQSxRQUFnQ0MsQ0FBQyxHQUFHSixDQUFDLEtBQUssR0FBTixHQUFZQyxDQUFaLEdBQWlCQSxDQUFDLElBQUksTUFBTSxHQUFWLENBQXREO0FBQ0EsV0FBT0csQ0FBQyxDQUFDQyxRQUFGLENBQVcsRUFBWCxDQUFQO0FBQ0QsR0FITSxDQUFQO0FBSUQ7O0FBR0QsU0FBU0MsbUJBQVQsQ0FBNkJDLElBQTdCLEVBQWtDQyxPQUFsQyxFQUEyQztBQUN6QztBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDRSxRQUFNQyxhQUFhLEdBQUcsQ0FBQyxTQUFELEVBQVcsTUFBWCxFQUFrQixPQUFsQixDQUF0QixDQWhCeUMsQ0FpQnpDOztBQUNBLE1BQUksQ0FBQ0YsSUFBSSxDQUFDLE9BQUQsQ0FBVCxFQUFvQjtBQUNsQkEsSUFBQUEsSUFBSSxDQUFDLE9BQUQsQ0FBSixHQUFnQixDQUFDQyxPQUFELENBQWhCO0FBQ0Q7O0FBQ0QsTUFBSSxPQUFPRCxJQUFJLENBQUMsT0FBRCxDQUFYLEtBQXlCLFFBQXpCLElBQXFDQSxJQUFJLENBQUMsT0FBRCxDQUFKLFlBQXlCRyxNQUFsRSxFQUEwRTtBQUN4RUgsSUFBQUEsSUFBSSxDQUFDLE9BQUQsQ0FBSixHQUFnQkEsSUFBSSxDQUFDLE9BQUQsQ0FBSixDQUFjSSxLQUFkLENBQW9CLEdBQXBCLENBQWhCO0FBQ0Q7O0FBQ0QsTUFBSSxDQUFDSixJQUFJLENBQUMsS0FBRCxDQUFULEVBQWtCO0FBQVE7QUFDeEIsUUFBSUssTUFBTSxHQUFJSixPQUFPLENBQUMsQ0FBRCxDQUFQLElBQVksR0FBYixHQUFtQixHQUFuQixHQUF5QkEsT0FBTyxDQUFDLENBQUQsQ0FBUCxDQUFXLENBQVgsQ0FBdEM7QUFDQUQsSUFBQUEsSUFBSSxDQUFDLEtBQUQsQ0FBSixHQUFjSyxNQUFNLEdBQUMsR0FBUCxHQUFXZCxNQUFNLEVBQS9CO0FBQ0Q7O0FBQ0QsUUFBTWUsR0FBRyxHQUFRLElBQUlDLElBQUosRUFBakI7QUFDQVAsRUFBQUEsSUFBSSxDQUFDLE9BQUQsQ0FBSixHQUFrQk0sR0FBRyxDQUFDRSxXQUFKLEVBQWxCOztBQUNBLE1BQUksQ0FBQ1IsSUFBSSxDQUFDLFNBQUQsQ0FBVCxFQUFzQjtBQUNwQkEsSUFBQUEsSUFBSSxDQUFDLFNBQUQsQ0FBSixHQUFrQixDQUFDO0FBQUMsZUFBUSxFQUFUO0FBQWEsY0FBTztBQUFwQixLQUFELENBQWxCO0FBQ0QsR0FoQ3dDLENBaUN6QztBQUNBO0FBQ0E7OztBQUNBLE1BQUksQ0FBQ0EsSUFBSSxDQUFDLFNBQUQsQ0FBVCxFQUNFQSxJQUFJLENBQUMsU0FBRCxDQUFKLEdBQWlCLEVBQWpCO0FBQ0YsTUFBSSxDQUFDQSxJQUFJLENBQUMsTUFBRCxDQUFULEVBQ0VBLElBQUksQ0FBQyxNQUFELENBQUosR0FBZSxFQUFmO0FBQ0YsTUFBSVMsTUFBTSxHQUFHVCxJQUFJLENBQUNVLE9BQUwsQ0FBYUMsS0FBYixDQUFtQixLQUFuQixDQUFiLENBeEN5QyxDQXdDQTs7QUFDekMsTUFBSUYsTUFBTSxLQUFHLElBQWIsRUFBbUI7QUFBRUEsSUFBQUEsTUFBTSxHQUFDLEVBQVA7QUFBWTs7QUFDakMsTUFBSUcsU0FBUyxHQUFFWixJQUFJLENBQUMsU0FBRCxDQUFKLENBQWdCVyxLQUFoQixDQUFzQiwwQkFBdEIsQ0FBZjs7QUFDQSxNQUFJQyxTQUFTLEtBQUcsSUFBaEIsRUFBc0I7QUFBRUEsSUFBQUEsU0FBUyxHQUFDLEVBQVY7QUFBZTs7QUFDdkNaLEVBQUFBLElBQUksQ0FBQyxNQUFELENBQUosR0FBZVMsTUFBTSxDQUFDSSxNQUFQLENBQWNiLElBQUksQ0FBQyxNQUFELENBQWxCLEVBQTRCYSxNQUE1QixDQUFtQ0QsU0FBbkMsQ0FBZjtBQUNBWixFQUFBQSxJQUFJLENBQUMsU0FBRCxDQUFKLEdBQWtCQSxJQUFJLENBQUMsU0FBRCxDQUFKLENBQWdCUixPQUFoQixDQUF3QixrQkFBeEIsRUFBMkMsR0FBM0MsQ0FBbEI7QUFDQSxRQUFNc0IsTUFBTSxHQUFHZCxJQUFJLENBQUMsU0FBRCxDQUFKLENBQWdCVyxLQUFoQixDQUFzQixnQkFBdEIsQ0FBZjs7QUFDQSxNQUFJRyxNQUFNLElBQUUsSUFBWixFQUFrQjtBQUNoQkEsSUFBQUEsTUFBTSxDQUFDQyxHQUFQLENBQVcsVUFBU0MsSUFBVCxFQUFlO0FBQ3hCLFlBQU1DLEtBQUssR0FBR0QsSUFBSSxDQUFDWixLQUFMLENBQVcsR0FBWCxDQUFkO0FBQ0EsVUFBSUosSUFBSSxDQUFDaUIsS0FBSyxDQUFDLENBQUQsQ0FBTixDQUFSLEVBQW9CO0FBQ2xCOztBQUNGLFVBQUlDLEtBQUssQ0FBQ0QsS0FBSyxDQUFDLENBQUQsQ0FBTixDQUFULEVBQXFCO0FBQ25CLGVBQU9qQixJQUFJLENBQUNpQixLQUFLLENBQUMsQ0FBRCxDQUFOLENBQUosR0FBaUJBLEtBQUssQ0FBQyxDQUFELENBQTdCO0FBQ0QsT0FGRCxNQUVPO0FBQ0wsZUFBT2pCLElBQUksQ0FBQ2lCLEtBQUssQ0FBQyxDQUFELENBQU4sQ0FBSixHQUFpQixDQUFDQSxLQUFLLENBQUMsQ0FBRCxDQUE5QjtBQUNEO0FBQ0YsS0FURDtBQVVELEdBMUR3QyxDQTJEekM7OztBQUNBakIsRUFBQUEsSUFBSSxDQUFDLFNBQUQsQ0FBSixHQUFrQkEsSUFBSSxDQUFDLFNBQUQsQ0FBSixDQUFnQlIsT0FBaEIsQ0FBd0IsZ0JBQXhCLEVBQXlDLEVBQXpDLENBQWxCLENBNUR5QyxDQTREdUI7O0FBQ2hFLE1BQUkyQixJQUFJLEdBQUduQixJQUFJLENBQUMsU0FBRCxDQUFKLENBQWdCSSxLQUFoQixDQUFzQixJQUF0QixDQUFYO0FBQ0FKLEVBQUFBLElBQUksQ0FBQyxTQUFELENBQUosR0FBa0IsRUFBbEI7O0FBQ0EsT0FBSyxJQUFJb0IsQ0FBQyxHQUFDLENBQVgsRUFBY0EsQ0FBQyxHQUFDRCxJQUFJLENBQUNFLE1BQXJCLEVBQTZCRCxDQUFDLEVBQTlCLEVBQWtDO0FBQ2hDLFVBQU1FLElBQUksR0FBR0gsSUFBSSxDQUFDQyxDQUFELENBQWpCO0FBQ0EsUUFBSUcsVUFBVSxHQUFHRCxJQUFJLENBQUNFLE1BQUwsQ0FBWSxNQUFaLENBQWpCOztBQUNBLFNBQUssSUFBSUMsT0FBTyxHQUFHLEVBQW5CLEVBQXNCQSxPQUFPLENBQUNKLE1BQVIsR0FBZTFCLElBQUksQ0FBQytCLEtBQUwsQ0FBV0gsVUFBVSxHQUFDLENBQXRCLElBQXlCLENBQTlELEVBQWlFRSxPQUFPLElBQUUsR0FBMUUsQ0FBOEUsQ0FIOUMsQ0FHK0M7OztBQUMvRXpCLElBQUFBLElBQUksQ0FBQyxTQUFELENBQUosSUFBbUJ5QixPQUFPLEdBQUNILElBQUksQ0FBQ0ssSUFBTCxFQUFSLEdBQW9CLElBQXZDLENBSmdDLENBSWM7QUFDL0M7O0FBQ0QzQixFQUFBQSxJQUFJLENBQUMsU0FBRCxDQUFKLEdBQWtCQSxJQUFJLENBQUMsU0FBRCxDQUFKLENBQWdCNEIsU0FBaEIsQ0FBMEIsQ0FBMUIsRUFBNkI1QixJQUFJLENBQUMsU0FBRCxDQUFKLENBQWdCcUIsTUFBaEIsR0FBdUIsQ0FBcEQsQ0FBbEI7O0FBQ0EsTUFBSSxPQUFPckIsSUFBSSxDQUFDLE1BQUQsQ0FBWCxLQUF3QixRQUF4QixJQUFvQ0EsSUFBSSxDQUFDLE1BQUQsQ0FBSixZQUF3QkcsTUFBaEUsRUFBd0U7QUFDdEVILElBQUFBLElBQUksQ0FBQyxNQUFELENBQUosR0FBZUEsSUFBSSxDQUFDLE1BQUQsQ0FBSixDQUFhSSxLQUFiLENBQW1CLEdBQW5CLENBQWY7QUFDRDs7QUFDREosRUFBQUEsSUFBSSxDQUFDLE1BQUQsQ0FBSixHQUFhQSxJQUFJLENBQUMsTUFBRCxDQUFKLENBQWFlLEdBQWIsQ0FBaUIsVUFBU2xCLENBQVQsRUFBVztBQUN2QyxXQUFPQSxDQUFDLENBQUM4QixJQUFGLEVBQVA7QUFDRCxHQUZZLENBQWIsQ0F6RXlDLENBNEV6Qzs7QUFDQSxNQUFJM0IsSUFBSSxDQUFDLE9BQUQsQ0FBSixDQUFjLENBQWQsTUFBbUIsUUFBdkIsRUFBaUM7QUFDL0IsUUFBSSxDQUFDQSxJQUFJLENBQUM2QixNQUFWLEVBQWtCO0FBQUM3QixNQUFBQSxJQUFJLENBQUMsUUFBRCxDQUFKLEdBQWUsRUFBZjtBQUFtQjs7QUFDdEMsUUFBSSxPQUFPQSxJQUFJLENBQUM2QixNQUFaLEtBQXVCLFFBQXZCLElBQW1DN0IsSUFBSSxDQUFDNkIsTUFBTCxZQUF1QjFCLE1BQTlELEVBQXNFO0FBQ3BFSCxNQUFBQSxJQUFJLENBQUM2QixNQUFMLEdBQVk3QixJQUFJLENBQUM2QixNQUFMLENBQVl6QixLQUFaLENBQWtCLEdBQWxCLENBQVo7QUFDRDtBQUNGOztBQUNELE1BQUlKLElBQUksQ0FBQyxPQUFELENBQUosQ0FBYyxDQUFkLE1BQW1CLGFBQXZCLEVBQXNDO0FBQ3BDLFFBQUksQ0FBQ0EsSUFBSSxDQUFDOEIsS0FBVixFQUFpQjtBQUFDOUIsTUFBQUEsSUFBSSxDQUFDLE9BQUQsQ0FBSixHQUFjLEVBQWQ7QUFBa0I7O0FBQ3BDLFFBQUksQ0FBQ0EsSUFBSSxDQUFDK0IsTUFBVixFQUFrQjtBQUFDL0IsTUFBQUEsSUFBSSxDQUFDLFFBQUQsQ0FBSixHQUFlLEVBQWY7QUFBbUI7QUFDdkMsR0F0RndDLENBdUZ6Qzs7O0FBQ0EsUUFBTWdDLElBQUksR0FBR0MsTUFBTSxDQUFDRCxJQUFQLENBQVloQyxJQUFaLENBQWI7QUFDQWdDLEVBQUFBLElBQUksQ0FBQ2pCLEdBQUwsQ0FBUyxVQUFTbUIsR0FBVCxFQUFhO0FBQ3BCLFFBQUksT0FBT2xDLElBQUksQ0FBQ2tDLEdBQUQsQ0FBWCxLQUFxQixRQUFyQixJQUFpQ2xDLElBQUksQ0FBQ2tDLEdBQUQsQ0FBSixZQUFxQi9CLE1BQTFELEVBQWtFO0FBQ2hFLFVBQUlILElBQUksQ0FBQ2tDLEdBQUQsQ0FBSixJQUFXLEVBQVgsSUFBaUJoQyxhQUFhLENBQUNpQyxPQUFkLENBQXNCRCxHQUF0QixLQUE0QixDQUFDLENBQWxELEVBQXFEO0FBQ25ELGVBQU9sQyxJQUFJLENBQUNrQyxHQUFELENBQVg7QUFDRCxPQUZELE1BRU87QUFDTGxDLFFBQUFBLElBQUksQ0FBQ2tDLEdBQUQsQ0FBSixHQUFZbEMsSUFBSSxDQUFDa0MsR0FBRCxDQUFKLENBQVVQLElBQVYsRUFBWjtBQUNEO0FBQ0Y7QUFDRixHQVJEO0FBU0EsU0FBTzNCLElBQVA7QUFDRDs7QUFHRCxTQUFTb0MsZUFBVCxDQUF5QkMsUUFBekIsRUFBbUNDLFdBQW5DLEVBQStDO0FBQzdDO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0UsTUFBSUMsUUFBUSxHQUFHLEVBQWY7QUFDQSxNQUFJQyxhQUFhLEdBQUcsRUFBcEI7QUFDQVAsRUFBQUEsTUFBTSxDQUFDRCxJQUFQLENBQVlLLFFBQVosRUFBc0J0QixHQUF0QixDQUEyQixVQUFTbUIsR0FBVCxFQUFhO0FBQ3RDLFFBQUlBLEdBQUcsSUFBRSxLQUFMLElBQWNBLEdBQUcsSUFBRSxNQUF2QixFQUNFO0FBQ0YsUUFBSU8sS0FBSyxHQUFHLElBQVo7O0FBQ0EsUUFBSVAsR0FBRyxJQUFJSSxXQUFQLElBQXNCLGFBQWFBLFdBQVcsQ0FBQ0osR0FBRCxDQUFsRCxFQUF5RDtBQUFHO0FBQzFETyxNQUFBQSxLQUFLLEdBQUdILFdBQVcsQ0FBQ0osR0FBRCxDQUFYLENBQWlCLFNBQWpCLENBQVI7QUFDRCxLQUZELE1BRU8sSUFBSUEsR0FBRyxDQUFDLENBQUQsQ0FBSCxJQUFRLEdBQVosRUFBaUI7QUFBb0M7QUFDMURPLE1BQUFBLEtBQUssR0FBRyxDQUFDLFVBQUQsRUFBWSxPQUFaLEVBQW9CLFVBQXBCLEVBQStCLGFBQS9CLEVBQThDUCxHQUFHLENBQUMsQ0FBRCxDQUFqRCxDQUFSO0FBQ0QsS0FGTSxNQUVBO0FBQXFEO0FBQzFETyxNQUFBQSxLQUFLLEdBQUdQLEdBQUcsQ0FBQyxDQUFELENBQUgsQ0FBT1EsV0FBUCxLQUFxQlIsR0FBRyxDQUFDUyxLQUFKLENBQVUsQ0FBVixDQUFyQixHQUFrQyxHQUExQztBQUNEOztBQUNELFFBQUlULEdBQUcsQ0FBQyxDQUFELENBQUgsSUFBUSxHQUFaLEVBQ0VNLGFBQWEsQ0FBQ04sR0FBRCxDQUFiLEdBQXFCTyxLQUFyQixDQURGLEtBR0VGLFFBQVEsQ0FBQ0wsR0FBRCxDQUFSLEdBQWdCTyxLQUFoQjtBQUNGO0FBQ0QsR0FoQkQ7QUFpQkEsU0FBTztBQUFDLGdCQUFXRixRQUFaO0FBQXNCLHFCQUFnQkM7QUFBdEMsR0FBUDtBQUNEOztBQUdELFNBQVNJLGdCQUFULENBQTBCNUMsSUFBMUIsRUFBZ0M2QyxLQUFoQyxFQUF1Q0MsUUFBdkMsRUFBaURDLE1BQWpELEVBQXlEQyxTQUF6RCxFQUFvRTtBQUNsRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0UsTUFBSUMsUUFBUSxHQUFHLEVBQWYsQ0Fma0UsQ0FnQmxFOztBQUNBLFFBQU1qQixJQUFJLEdBQUdDLE1BQU0sQ0FBQ0QsSUFBUCxDQUFZaEMsSUFBWixDQUFiO0FBQ0EsTUFBSWtELFVBQVUsR0FBRyxJQUFqQjs7QUFDQSxPQUFLLElBQUk5QixDQUFDLEdBQUMsQ0FBWCxFQUFjQSxDQUFDLEdBQUNZLElBQUksQ0FBQ1gsTUFBckIsRUFBNkJELENBQUMsRUFBOUIsRUFBa0M7QUFDaEMsVUFBTWMsR0FBRyxHQUFHRixJQUFJLENBQUNaLENBQUQsQ0FBaEI7QUFDQSxVQUFNK0IsS0FBSyxHQUFHbkQsSUFBSSxDQUFDa0MsR0FBRCxDQUFsQjs7QUFDQSxRQUFJaUIsS0FBSyxDQUFDLENBQUQsQ0FBTCxLQUFXakIsR0FBZixFQUFvQjtBQUFFO0FBQ3BCZ0IsTUFBQUEsVUFBVSxHQUFHaEIsR0FBYjtBQUNELEtBRkQsTUFFTztBQUFjO0FBQ25CLFVBQUlrQixZQUFZLEdBQUdELEtBQUssQ0FBQyxDQUFELENBQUwsQ0FBUy9DLEtBQVQsQ0FBZSxHQUFmLENBQW5CO0FBQ0E4QyxNQUFBQSxVQUFVLEdBQUdFLFlBQVksQ0FBQyxDQUFELENBQXpCLENBRkssQ0FFMEI7O0FBQy9CLFdBQUssSUFBSUMsQ0FBQyxHQUFDLENBQVgsRUFBY0EsQ0FBQyxHQUFDRCxZQUFZLENBQUMvQixNQUE3QixFQUFxQ2dDLENBQUMsRUFBdEMsRUFBMEM7QUFDeEMsY0FBTUMsRUFBRSxHQUFHRixZQUFZLENBQUNDLENBQUQsQ0FBdkI7QUFDQSxZQUFJRSxRQUFRLEdBQUcsQ0FBZjtBQUNBLFlBQUlELEVBQUUsSUFBSXRELElBQVYsRUFBZ0J1RCxRQUFRLEdBQUd2RCxJQUFJLENBQUNzRCxFQUFELENBQUosQ0FBUyxDQUFULENBQVg7O0FBQ2hCLFlBQUlDLFFBQVEsR0FBQyxJQUFiLEVBQW1CO0FBQ2pCQyxVQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSxtREFBaUR2QixHQUE3RDtBQUNEOztBQUNEZ0IsUUFBQUEsVUFBVSxJQUFJLE1BQUksQ0FBQyxPQUFLSyxRQUFOLEVBQWdCRyxNQUFoQixDQUF1QixDQUFDLENBQXhCLENBQUosR0FBK0IsR0FBL0IsR0FBbUNKLEVBQWpELENBUHdDLENBT2E7QUFDdEQsT0FYSSxDQVlMOztBQUNELEtBbEIrQixDQW1CaEM7OztBQUNBTCxJQUFBQSxRQUFRLENBQUNVLElBQVQsQ0FBYztBQUFDQyxNQUFBQSxTQUFTLEVBQUNWLFVBQVg7QUFBdUJULE1BQUFBLEtBQUssRUFBQ1UsS0FBSyxDQUFDUixLQUFOLENBQVksQ0FBWjtBQUE3QixLQUFkO0FBQ0QsR0F4Q2lFLENBeUNsRTs7O0FBQ0EsV0FBU2tCLE9BQVQsQ0FBaUJDLENBQWpCLEVBQW1CQyxDQUFuQixFQUFxQjtBQUNuQixRQUFJRCxDQUFDLENBQUNGLFNBQUYsR0FBWUcsQ0FBQyxDQUFDSCxTQUFsQixFQUE2QixPQUFPLENBQVAsQ0FBN0IsS0FDNkIsT0FBTyxDQUFDLENBQVI7QUFDOUI7O0FBQ0RYLEVBQUFBLFFBQVEsQ0FBQ2UsSUFBVCxDQUFjSCxPQUFkLEVBOUNrRSxDQWdEbEU7QUFDQTtBQUVBOztBQUNBLE1BQUlJLFNBQVMsR0FBR2hCLFFBQVEsQ0FBQ2xDLEdBQVQsQ0FBYSxVQUFTQyxJQUFULEVBQWM7QUFDekMsVUFBTWtELGNBQWMsR0FBR2xELElBQUksQ0FBQzRDLFNBQUwsQ0FBZXhELEtBQWYsQ0FBcUIsR0FBckIsQ0FBdkI7QUFDQSxVQUFNK0QsTUFBTSxHQUFHRCxjQUFjLENBQUM3QyxNQUFmLEdBQXNCLENBQXRCLEdBQXdCLEdBQXZDOztBQUNBLFNBQUssSUFBSWhCLE1BQU0sR0FBRyxFQUFsQixFQUFxQkEsTUFBTSxDQUFDZ0IsTUFBUCxJQUFlOEMsTUFBcEMsRUFBNEM5RCxNQUFNLElBQUUsR0FBcEQsQ0FBd0QsQ0FIZixDQUdnQjs7O0FBQ3pELFFBQUl3QyxLQUFLLEtBQUcsSUFBWixFQUFrQjtBQUNoQixVQUFJdUIsVUFBVSxHQUFHcEQsSUFBSSxDQUFDeUIsS0FBTCxDQUFXLENBQVgsQ0FBakI7QUFDQSxVQUFJNEIsS0FBSyxHQUFHSCxjQUFjLENBQUNBLGNBQWMsQ0FBQzdDLE1BQWYsR0FBc0IsQ0FBdkIsQ0FBMUI7QUFDQStDLE1BQUFBLFVBQVUsSUFBSSxPQUFLQyxLQUFuQjs7QUFDQSxVQUFJLE9BQU92QixRQUFQLEtBQW9CLFVBQXhCLEVBQW1DO0FBQ2pDLFlBQUl3QixHQUFHLEdBQUd4QixRQUFRLENBQUN1QixLQUFELENBQWxCOztBQUNBLFlBQUl0QixNQUFNLEtBQUcsS0FBYixFQUFtQjtBQUNqQixlQUFLLElBQUkzQixDQUFDLEdBQUMsQ0FBWCxFQUFjQSxDQUFDLEdBQUNrRCxHQUFHLENBQUMsU0FBRCxDQUFILENBQWVqRCxNQUEvQixFQUF1Q0QsQ0FBQyxFQUF4QyxFQUE0QztBQUMxQ2dELFlBQUFBLFVBQVUsSUFBSSxhQUFXRSxHQUFHLENBQUMsU0FBRCxDQUFILENBQWVsRCxDQUFmLEVBQWtCbUQsSUFBM0M7QUFDRDs7QUFDREgsVUFBQUEsVUFBVSxJQUFJLGlCQUFkOztBQUNBLGVBQUssSUFBSUksRUFBRSxHQUFDLENBQVosRUFBZUEsRUFBRSxHQUFDRixHQUFHLENBQUMsU0FBRCxDQUFILENBQWVqRCxNQUFqQyxFQUF5Q21ELEVBQUUsRUFBM0MsRUFBK0M7QUFDN0NKLFlBQUFBLFVBQVUsSUFBSUUsR0FBRyxDQUFDLFNBQUQsQ0FBSCxDQUFlRSxFQUFmLEVBQW1CQyxLQUFuQixHQUF5QixHQUF2QztBQUNEO0FBQ0Y7O0FBQ0QsWUFBSUgsR0FBRyxDQUFDLE9BQUQsQ0FBSCxJQUFjLENBQUMsR0FBRCxFQUFLLFNBQUwsQ0FBbEIsRUFBbUM7QUFDakNGLFVBQUFBLFVBQVUsSUFBSSxrQkFBZ0JFLEdBQUcsQ0FBQ0ksU0FBbEM7QUFDRDs7QUFDRCxhQUFLLElBQUlDLEVBQUUsR0FBQyxDQUFaLEVBQWVBLEVBQUUsR0FBQzNCLFNBQVMsQ0FBQzNCLE1BQTVCLEVBQW9Dc0QsRUFBRSxFQUF0QyxFQUF5QztBQUN2QyxjQUFJTCxHQUFHLENBQUNNLElBQUosQ0FBU3pDLE9BQVQsQ0FBaUIsTUFBSWEsU0FBUyxDQUFDMkIsRUFBRCxDQUE5QixJQUFvQyxDQUFDLENBQXpDLEVBQTJDO0FBQ3pDdEUsWUFBQUEsTUFBTSxHQUFHQSxNQUFNLEdBQUcsR0FBVCxHQUFhMkMsU0FBUyxDQUFDMkIsRUFBRCxDQUEvQjs7QUFDQSxpQkFBSyxJQUFJRSxFQUFFLEdBQUcsQ0FBZCxFQUFpQkEsRUFBRSxHQUFHUCxHQUFHLENBQUNNLElBQUosQ0FBU3ZELE1BQS9CLEVBQXVDd0QsRUFBRSxFQUF6QyxFQUE0QztBQUMxQyxrQkFBS1AsR0FBRyxDQUFDTSxJQUFKLENBQVNDLEVBQVQsTUFBZSxNQUFJN0IsU0FBUyxDQUFDMkIsRUFBRCxDQUFqQyxFQUF1QztBQUNyQ0wsZ0JBQUFBLEdBQUcsQ0FBQ00sSUFBSixDQUFTRSxNQUFULENBQWdCMUQsQ0FBaEIsRUFBbUIsQ0FBbkI7QUFDQUEsZ0JBQUFBLENBQUM7QUFDRjtBQUNGO0FBQ0Y7QUFDRjs7QUFDRGdELFFBQUFBLFVBQVUsSUFBSSxhQUFXRSxHQUFHLENBQUNNLElBQUosQ0FBU0csSUFBVCxDQUFjLEdBQWQsQ0FBWCxHQUE4QixJQUE5QixHQUFtQ1QsR0FBRyxDQUFDNUQsT0FBckQ7QUFDRDs7QUFDRDBELE1BQUFBLFVBQVUsR0FBRy9ELE1BQU0sR0FBQyxHQUFQLEdBQVkrRCxVQUF6QjtBQUNELEtBaENELE1BZ0NPO0FBQ0xBLE1BQUFBLFVBQVUsR0FBRy9ELE1BQU0sR0FBQyxHQUFQLEdBQVdXLElBQUksQ0FBQ3lCLEtBQUwsQ0FBVyxDQUFYLENBQVgsR0FBeUIsSUFBekIsR0FBOEJ6QixJQUFJLENBQUN5QixLQUFMLENBQVcsQ0FBWCxDQUEzQztBQUNEOztBQUNELFdBQU8yQixVQUFQO0FBQ0QsR0F4Q2UsQ0FBaEIsQ0FwRGtFLENBNkZsRTs7QUFDQSxTQUFPSCxTQUFTLENBQUNjLElBQVYsQ0FBZSxJQUFmLENBQVA7QUFDRDs7QUFFRCxTQUFTQyxlQUFULENBQXlCN0QsSUFBekIsRUFBK0I2QixTQUEvQixFQUEwQztBQUN4QztBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0UsTUFBSWlDLElBQUksR0FBRyxFQUFYO0FBQ0EsTUFBSVAsU0FBUyxHQUFDLElBQWQ7QUFBQSxNQUFvQkUsSUFBSSxHQUFDLElBQXpCO0FBQUEsTUFBK0JsRSxPQUFPLEdBQUMsSUFBdkM7QUFBQSxNQUE2Q3dFLEtBQUssR0FBQyxFQUFuRDtBQUFBLE1BQXVEYixLQUFLLEdBQUMsRUFBN0Q7QUFBQSxNQUFpRXBFLE9BQU8sR0FBQyxFQUF6RTtBQUNBa0IsRUFBQUEsSUFBSSxHQUFHQSxJQUFJLENBQUNmLEtBQUwsQ0FBVyxJQUFYLENBQVA7O0FBQ0EsT0FBSyxJQUFJZ0IsQ0FBQyxHQUFDLENBQVgsRUFBY0EsQ0FBQyxHQUFDRCxJQUFJLENBQUNFLE1BQXJCLEVBQTZCRCxDQUFDLEVBQTlCLEVBQWtDO0FBQ2hDLFVBQU1FLElBQUksR0FBR0gsSUFBSSxDQUFDQyxDQUFELENBQWpCOztBQUNBLFFBQUlFLElBQUksQ0FBQ00sU0FBTCxDQUFlLENBQWYsRUFBaUIsQ0FBakIsTUFBc0IsSUFBdEIsSUFBK0JOLElBQUksQ0FBQ00sU0FBTCxDQUFlLENBQWYsRUFBaUIsQ0FBakIsTUFBc0IsS0FBckQsSUFBK0ROLElBQUksQ0FBQ00sU0FBTCxDQUFlLENBQWYsRUFBaUIsQ0FBakIsTUFBc0IsTUFBckYsSUFDQU4sSUFBSSxDQUFDTSxTQUFMLENBQWUsQ0FBZixFQUFpQixDQUFqQixNQUFzQixPQUR0QixJQUMrQk4sSUFBSSxDQUFDTSxTQUFMLENBQWUsQ0FBZixFQUFpQixDQUFqQixNQUFzQixRQURyRCxJQUMrRE4sSUFBSSxDQUFDTSxTQUFMLENBQWUsQ0FBZixFQUFpQixDQUFqQixNQUFzQixTQUR6RixFQUNtRztBQUNqRztBQUNBLFVBQUlsQixPQUFKLEVBQ0VBLE9BQU8sR0FBR0EsT0FBTyxDQUFDaUIsSUFBUixFQUFWLENBSCtGLENBR3JFOztBQUM1QixVQUFJd0QsSUFBSSxHQUFHO0FBQUMsaUJBQVFELEtBQVQ7QUFBZU4sUUFBQUEsSUFBSSxFQUFDQSxJQUFwQjtBQUF5QmxFLFFBQUFBLE9BQU8sRUFBQ0EsT0FBakM7QUFBeUMwRSxRQUFBQSxHQUFHLEVBQUNmLEtBQTdDO0FBQW1ELGlCQUFRcEU7QUFBM0QsT0FBWDtBQUNBLFVBQUl5RSxTQUFKLEVBQ0VTLElBQUksQ0FBQyxXQUFELENBQUosR0FBb0JULFNBQXBCOztBQUNGLFVBQUlRLEtBQUssSUFBRSxVQUFQLElBQXFCYixLQUFLLElBQUUsRUFBaEMsRUFBb0M7QUFDbENjLFFBQUFBLElBQUksQ0FBQyxNQUFELENBQUosR0FBZSxVQUFmO0FBQ0QsT0FGRCxNQUVPO0FBQ0wsWUFBSWQsS0FBSyxJQUFFLEVBQVgsRUFDRWMsSUFBSSxDQUFDLE1BQUQsQ0FBSixHQUFlLE9BQWYsQ0FERixLQUdFQSxJQUFJLENBQUMsTUFBRCxDQUFKLEdBQWUsUUFBZjtBQUNIOztBQUNELFVBQUlkLEtBQUssSUFBRSxFQUFQLElBQWFhLEtBQUssSUFBRSxFQUF4QixFQUNFRCxJQUFJLENBQUN0QixJQUFMLENBQVV3QixJQUFWLEVBaEIrRixDQWlCakc7O0FBQ0FULE1BQUFBLFNBQVMsR0FBQyxJQUFWO0FBQWdCRSxNQUFBQSxJQUFJLEdBQUMsSUFBTDtBQUFXbEUsTUFBQUEsT0FBTyxHQUFDLElBQVI7QUFBY3dFLE1BQUFBLEtBQUssR0FBQyxFQUFOO0FBQVViLE1BQUFBLEtBQUssR0FBQyxFQUFOO0FBQVVwRSxNQUFBQSxPQUFPLEdBQUMsRUFBUixDQWxCb0MsQ0FtQmpHOztBQUNBLFlBQU1vRixLQUFLLEdBQUcvRCxJQUFJLENBQUNsQixLQUFMLENBQVcsSUFBWCxDQUFkO0FBQ0E4RSxNQUFBQSxLQUFLLEdBQUdHLEtBQUssQ0FBQyxDQUFELENBQUwsQ0FBU2pGLEtBQVQsQ0FBZSxHQUFmLEVBQW9CdUMsS0FBcEIsQ0FBMEIsQ0FBMUIsRUFBNkJvQyxJQUE3QixDQUFrQyxHQUFsQyxFQUF1Q3BELElBQXZDLEVBQVI7O0FBQ0EsV0FBSyxJQUFJMEIsQ0FBQyxHQUFDTCxTQUFTLENBQUMzQixNQUFWLEdBQWlCLENBQTVCLEVBQStCZ0MsQ0FBQyxJQUFFLENBQWxDLEVBQXFDQSxDQUFDLEVBQXRDLEVBQXlDO0FBQ3ZDLFlBQUk2QixLQUFLLENBQUN0RCxTQUFOLENBQWdCLENBQWhCLEVBQWtCLENBQWxCLE1BQXVCb0IsU0FBUyxDQUFDSyxDQUFELENBQXBDLEVBQXdDO0FBQ3RDNkIsVUFBQUEsS0FBSyxHQUFHQSxLQUFLLENBQUN2QyxLQUFOLENBQVlLLFNBQVMsQ0FBQ0ssQ0FBRCxDQUFULENBQWFoQyxNQUFiLEdBQW9CLENBQWhDLENBQVI7QUFDQXVELFVBQUFBLElBQUksSUFBSSxNQUFJNUIsU0FBUyxDQUFDSyxDQUFELENBQWIsR0FBaUIsR0FBekI7QUFDRDtBQUNGOztBQUNELFVBQUl1QixJQUFKLEVBQ0VBLElBQUksR0FBR0EsSUFBSSxDQUFDakQsSUFBTCxFQUFQO0FBQ0YsVUFBSTBELEtBQUssQ0FBQ2hFLE1BQU4sR0FBYyxDQUFsQixFQUFxQmdELEtBQUssR0FBR2dCLEtBQUssQ0FBQ0EsS0FBSyxDQUFDaEUsTUFBTixHQUFhLENBQWQsQ0FBYjtBQUNyQnBCLE1BQUFBLE9BQU8sR0FBR3FCLElBQUksQ0FBQ2xCLEtBQUwsQ0FBVyxHQUFYLEVBQWdCLENBQWhCLEVBQW1CaUIsTUFBbkIsR0FBMEIsQ0FBcEMsQ0EvQmlHLENBK0I3QztBQUNyRCxLQWpDRCxNQWtDSyxJQUFJQyxJQUFJLENBQUNNLFNBQUwsQ0FBZSxDQUFmLEVBQWlCLEVBQWpCLE1BQXVCLFlBQTNCLEVBQ0g4QyxTQUFTLEdBQUdwRCxJQUFJLENBQUNNLFNBQUwsQ0FBZSxFQUFmLEVBQWtCTixJQUFJLENBQUNELE1BQXZCLEVBQStCTSxJQUEvQixFQUFaLENBREcsS0FFQSxJQUFJTCxJQUFJLENBQUNNLFNBQUwsQ0FBZSxDQUFmLEVBQWlCLENBQWpCLE1BQXVCLE9BQTNCLEVBQ0hnRCxJQUFJLEdBQVNBLElBQUksS0FBRyxJQUFSLEdBQW1CdEQsSUFBSSxDQUFDTSxTQUFMLENBQWUsQ0FBZixFQUFpQk4sSUFBSSxDQUFDRCxNQUF0QixFQUE4Qk0sSUFBOUIsRUFBbkIsR0FDVmlELElBQUksR0FBQ3RELElBQUksQ0FBQ00sU0FBTCxDQUFlLENBQWYsRUFBaUJOLElBQUksQ0FBQ0QsTUFBdEIsRUFBOEJNLElBQTlCLEVBRFAsQ0FERyxLQUlMLElBQUssQ0FBRSxVQUFVMkQsSUFBVixDQUFlaEUsSUFBZixDQUFQLEVBQ0VaLE9BQU8sR0FBTUEsT0FBTyxLQUFHLElBQVgsR0FBbUJZLElBQUksR0FBQyxJQUF4QixHQUErQlosT0FBTyxHQUFDWSxJQUFSLEdBQWEsSUFBeEQ7QUFDSCxHQTNEdUMsQ0E0RHhDOzs7QUFDQSxNQUFJWixPQUFKLEVBQ0VBLE9BQU8sR0FBR0EsT0FBTyxDQUFDaUIsSUFBUixFQUFWO0FBQ0Z3RCxFQUFBQSxJQUFJLEdBQUc7QUFBQyxhQUFRRCxLQUFUO0FBQWVOLElBQUFBLElBQUksRUFBQ0EsSUFBcEI7QUFBeUJsRSxJQUFBQSxPQUFPLEVBQUNBLE9BQWpDO0FBQXlDMEUsSUFBQUEsR0FBRyxFQUFDZixLQUE3QztBQUFtRCxhQUFRcEU7QUFBM0QsR0FBUDtBQUNBLE1BQUl5RSxTQUFKLEVBQ0VTLElBQUksQ0FBQyxXQUFELENBQUosR0FBb0JULFNBQXBCOztBQUNGLE1BQUlRLEtBQUssSUFBRSxVQUFQLElBQXFCYixLQUFLLElBQUUsRUFBaEMsRUFBb0M7QUFDbENjLElBQUFBLElBQUksQ0FBQyxNQUFELENBQUosR0FBZSxVQUFmO0FBQ0QsR0FGRCxNQUVPO0FBQ0wsUUFBSWQsS0FBSyxJQUFFLEVBQVgsRUFDRWMsSUFBSSxDQUFDLE1BQUQsQ0FBSixHQUFlLE9BQWYsQ0FERixLQUdFQSxJQUFJLENBQUMsTUFBRCxDQUFKLEdBQWUsUUFBZjtBQUNIOztBQUNERixFQUFBQSxJQUFJLENBQUN0QixJQUFMLENBQVV3QixJQUFWO0FBQ0EsU0FBT0YsSUFBUDtBQUNEOztBQUdELFNBQVNNLFdBQVQsQ0FBcUJ2RixJQUFyQixFQUEwQnFFLEtBQTFCLEVBQWdDO0FBQzlCO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDRSxNQUFJbUIsS0FBSyxHQUFHLEVBQVo7QUFDQSxNQUFJQyxHQUFHLEdBQUssRUFBWjtBQUNBLE1BQUlDLFFBQVEsR0FBRyxLQUFmO0FBQ0EsTUFBSUMsY0FBYyxHQUFHLENBQUMsQ0FBdEI7QUFDQSxRQUFNQyxLQUFLLEdBQUc1RixJQUFJLENBQUNJLEtBQUwsQ0FBVyxJQUFYLENBQWQ7O0FBQ0EsT0FBSyxJQUFJZ0IsQ0FBQyxHQUFDLENBQVgsRUFBY0EsQ0FBQyxHQUFDd0UsS0FBSyxDQUFDdkUsTUFBdEIsRUFBOEJELENBQUMsRUFBL0IsRUFBa0M7QUFDaEMsVUFBTXlFLEtBQUssR0FBR0QsS0FBSyxDQUFDeEUsQ0FBRCxDQUFMLENBQVNoQixLQUFULENBQWUsSUFBZixDQUFkOztBQUNBLFFBQUlzRixRQUFKLEVBQWM7QUFDWixZQUFNSSxNQUFNLEdBQUdELEtBQUssQ0FBQyxDQUFELENBQUwsQ0FBU3pGLEtBQVQsQ0FBZSxHQUFmLEVBQW9CLENBQXBCLEVBQXVCaUIsTUFBdEM7QUFDQSxVQUFJeUUsTUFBTSxLQUFLSCxjQUFmLEVBQStCOztBQUMvQixVQUFJRyxNQUFNLEtBQUtILGNBQWMsR0FBQyxDQUE5QixFQUFpQztBQUMvQkYsUUFBQUEsR0FBRyxDQUFDOUIsSUFBSixDQUFTa0MsS0FBSyxDQUFDLENBQUQsQ0FBZDtBQUNBTCxRQUFBQSxLQUFLLENBQUM3QixJQUFOLENBQVdrQyxLQUFLLENBQUMsQ0FBRCxDQUFMLENBQVNqRSxTQUFULENBQW1CK0QsY0FBYyxHQUFDLENBQWxDLENBQVg7QUFDRDtBQUNGOztBQUNELFFBQUlFLEtBQUssQ0FBQyxDQUFELENBQUwsS0FBV3hCLEtBQWYsRUFBc0I7QUFDcEIsVUFBSXdCLEtBQUssQ0FBQyxDQUFELENBQUwsQ0FBUyxDQUFULE1BQWMsR0FBbEIsRUFBdUI7QUFDckJGLFFBQUFBLGNBQWMsR0FBR0UsS0FBSyxDQUFDLENBQUQsQ0FBTCxDQUFTekYsS0FBVCxDQUFlLEdBQWYsRUFBb0JpQixNQUFyQztBQUNELE9BRkQsTUFFTztBQUNMc0UsUUFBQUEsY0FBYyxHQUFHLENBQWpCO0FBQ0Q7O0FBQ0RELE1BQUFBLFFBQVEsR0FBRyxJQUFYO0FBQ0Q7QUFDRjs7QUFDRCxTQUFPO0FBQUNGLElBQUFBLEtBQUssRUFBRUEsS0FBUjtBQUFlQyxJQUFBQSxHQUFHLEVBQUNBO0FBQW5CLEdBQVA7QUFDRDs7QUFHRCxTQUFTTSxTQUFULENBQW1CQyxHQUFuQixFQUF3QjtBQUN0QjtBQUNGO0FBQ0E7QUFDQTtBQUNFLE1BQUkvQixTQUFTLEdBQUcrQixHQUFHLENBQUN4RyxPQUFKLENBQVkseUJBQVosRUFBdUMsVUFBU21CLEtBQVQsRUFBZ0I7QUFDckUsUUFBSSxNQUFNMkUsSUFBTixDQUFXM0UsS0FBWCxDQUFKLEVBQXVCLE9BQU8sRUFBUCxDQUQ4QyxDQUNuQzs7QUFDbEMsV0FBT0EsS0FBSyxDQUFDK0IsV0FBTixFQUFQLENBRnFFLENBRW5DO0FBQ25DLEdBSGUsQ0FBaEI7QUFJQXVCLEVBQUFBLFNBQVMsR0FBR0EsU0FBUyxDQUFDekUsT0FBVixDQUFrQixLQUFsQixFQUF3QixFQUF4QixDQUFaO0FBQ0EsU0FBT3lFLFNBQVA7QUFDRDs7QUFHRGdDLE9BQU8sQ0FBQ2xHLG1CQUFSLEdBQThCQSxtQkFBOUI7QUFDQWtHLE9BQU8sQ0FBQzdELGVBQVIsR0FBMEJBLGVBQTFCO0FBQ0E2RCxPQUFPLENBQUNyRCxnQkFBUixHQUEyQkEsZ0JBQTNCO0FBQ0FxRCxPQUFPLENBQUNqQixlQUFSLEdBQTBCQSxlQUExQjtBQUNBaUIsT0FBTyxDQUFDVixXQUFSLEdBQXNCQSxXQUF0QjtBQUNBVSxPQUFPLENBQUNGLFNBQVIsR0FBb0JBLFNBQXBCIiwic291cmNlc0NvbnRlbnQiOlsiLyogQ29tbW9uIGZ1bmN0aW9ucyBmb3IganMtIGFuZCBweXRob24gY29kZVxuICBPTkxZIFdyaXR0ZW4gaGVyZSBpbiBqcy4gcHl0aG9uIGZ1bmN0aW9ucyBhcmUgb2J0YWluZWQgYnkgYXV0b21hdGljIHRyYW5zbGF0aW9uXG4gIFB5dGhvbkZvbGRlcjogZXhlY3V0ZSAnYXNUb29scy5weSdcbiovXG5cbmZ1bmN0aW9uIHV1aWR2NCgpIHtcbiAgLy8gc2luY2UgcHkgYW5kIGpzIGNvdWxkIHVzZSBzYW1lIGRvY3VtZW50IGNyZWF0aW9uOiB0aGV5IGhhdmUgdG8gY3JlYXRlIHNpbWlsYXIgc2hhcGVkIHV1aWRzXG4gIC8vIGZyb206IGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzEwNTAzNC9jcmVhdGUtZ3VpZC11dWlkLWluLWphdmFzY3JpcHRcbiAgLy8gLSB1c2VkIGludGVybmFsIGluIHRoaXMgZmlsZVxuICByZXR1cm4gJ3h4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4Jy5yZXBsYWNlKC9beF0vZywgZnVuY3Rpb24oYykge1xuICAgIHZhciByID0gTWF0aC5yYW5kb20oKSAqIDE2IHwgMCwgdiA9IGMgPT09ICd4JyA/IHIgOiAociAmICgweDMgfCAweDgpKTtcbiAgICByZXR1cm4gdi50b1N0cmluZygxNik7XG4gIH0pO1xufVxuXG5cbmZ1bmN0aW9uIGZpbGxEb2NCZWZvcmVDcmVhdGUoZGF0YSxkb2NUeXBlKSB7XG4gIC8qKlxuICAgKiAgRmlsbCB0aGUgZGF0YSBiZWZvcmUgc3VibWlzc2lvbiB0byBkYXRhYmFzZSB3aXRoIGNvbW1vbiBkYXRhXG4gICAqIC0gdHlwZSwgcHJvamVjdCwgY2hpbGRzXG4gICAqIC0gc2VwYXJhdGUgY29tbWVudCBpbnRvIHRhZ3MsIGZpZWxkc1xuICAgKiAtIGNyZWF0ZSBpZCBpZiBuZWVkZWRcbiAgICpcbiAgICogdXNlZCBpbiBiYWNrZW5kLnB5IGFuZCBTdG9yZS5qc1xuICAgKlxuICAgKiBBcmdzOlxuICAgKiAgICBkYXRhOiBkb2N1bWVudCB0byBzYXZlXG4gICAqICAgIGRvY1R5cGU6IHR5cGUgb2YgZG9jdW1lbnQsIGUuZy4gcHJvamVjdFxuICAgKlxuICAgKiBSZXR1cm5zOlxuICAgKiAgICBkb2N1bWVudFxuICAgKi9cbiAgY29uc3QgcHJvdGVjdGVkS2V5cyA9IFsnY29tbWVudCcsJ3RhZ3MnLCdpbWFnZSddO1xuICAvL0hhbmRsZSB0aGUgaW1wb3J0YW50IGVudHJpZXM6IC10eXBlLCBfaWQsIC1kYXRlLCAtYnJhbmNoXG4gIGlmICghZGF0YVsnLXR5cGUnXSkge1xuICAgIGRhdGFbJy10eXBlJ10gPSBbZG9jVHlwZV07XG4gIH1cbiAgaWYgKHR5cGVvZiBkYXRhWyctdHlwZSddID09PSAnc3RyaW5nJyB8fCBkYXRhWyctdHlwZSddIGluc3RhbmNlb2YgU3RyaW5nKSB7XG4gICAgZGF0YVsnLXR5cGUnXSA9IGRhdGFbJy10eXBlJ10uc3BsaXQoJy8nKTtcbiAgfVxuICBpZiAoIWRhdGFbJ19pZCddKSB7ICAgICAgIC8vaWYgbmV3IChpZiBub3QgdXBkYXRlKTogY3JlYXRlIG5ldyBpZFxuICAgIHZhciBwcmVmaXggPSAoZG9jVHlwZVswXT09J3gnKT8gJ3gnIDogZG9jVHlwZVswXVswXTtcbiAgICBkYXRhWydfaWQnXSA9IHByZWZpeCsnLScrdXVpZHY0KCk7XG4gIH1cbiAgY29uc3Qgbm93ICAgICAgPSBuZXcgRGF0ZSgpO1xuICBkYXRhWyctZGF0ZSddICAgPSBub3cudG9JU09TdHJpbmcoKTtcbiAgaWYgKCFkYXRhWyctYnJhbmNoJ10pIHtcbiAgICBkYXRhWyctYnJhbmNoJ10gPSBbeydzdGFjayc6W10sICdwYXRoJzpudWxsfV07XG4gIH1cbiAgLy9zZXBhcmF0ZSBjb21tZW50IGludG8gdGFncyBhbmQgZmllbGRzXG4gIC8vdGhlc2UgdGFncyBhcmUgbG9zdDogJyNkJzogdG9vIHNob3J0OyAnIzN0YWcnOiBzdGFydHMgd2l0aCBudW1iZXJcbiAgLy8gIE5vdGU6IHNob3VsZCBkaXN0aW5ndWlzaCBiZXR3ZWVuIGNvbW1lbnQ9PW51bGwgdnMuIGNvbW1lbnQ9PXVuZGVmaW5lZDogYnV0IG5vdCBwb3NzaWJsZSB3aXRoIGpzMnB5XG4gIGlmICghZGF0YVsnY29tbWVudCddKVxuICAgIGRhdGFbJ2NvbW1lbnQnXSA9Jyc7XG4gIGlmICghZGF0YVsndGFncyddKVxuICAgIGRhdGFbJ3RhZ3MnXSA9IFtdO1xuICB2YXIgcmF0aW5nID0gZGF0YS5jb21tZW50Lm1hdGNoKC8jXFxkLyk7ICAvL29uZSBjaGFyYWN0ZXIgZm9sbG93aW5nICNcbiAgaWYgKHJhdGluZz09PW51bGwpIHsgcmF0aW5nPVtdOyB9XG4gIHZhciBvdGhlclRhZ3M9IGRhdGFbJ2NvbW1lbnQnXS5tYXRjaCgvKF58XFxzKSN7MX1bYS16QS1aXVtcXHddKy9nKTtcbiAgaWYgKG90aGVyVGFncz09PW51bGwpIHsgb3RoZXJUYWdzPVtdOyB9XG4gIGRhdGFbJ3RhZ3MnXSA9IHJhdGluZy5jb25jYXQoZGF0YVsndGFncyddKS5jb25jYXQob3RoZXJUYWdzKTtcbiAgZGF0YVsnY29tbWVudCddID0gZGF0YVsnY29tbWVudCddLnJlcGxhY2UoLyhefFxccykjezF9W1xcd10rL2csJyAnKTtcbiAgY29uc3QgZmllbGRzID0gZGF0YVsnY29tbWVudCddLm1hdGNoKC86W1xcU10rOltcXFNdKzovZyk7XG4gIGlmIChmaWVsZHMhPW51bGwpIHtcbiAgICBmaWVsZHMubWFwKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgIGNvbnN0IGFMaXN0ID0gaXRlbS5zcGxpdCgnOicpO1xuICAgICAgaWYgKGRhdGFbYUxpc3RbMV1dKSAvL2RvIG5vdCBhZGQgaWYgaXRlbSBhbHJlYWR5IGV4aXN0c1xuICAgICAgICByZXR1cm47XG4gICAgICBpZiAoaXNOYU4oYUxpc3RbMl0pKSB7XG4gICAgICAgIHJldHVybiBkYXRhW2FMaXN0WzFdXSA9IGFMaXN0WzJdO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGRhdGFbYUxpc3RbMV1dID0gK2FMaXN0WzJdO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG4gIC8vIGNsZWFuIHRoZSBjb21tZW50c1xuICBkYXRhWydjb21tZW50J10gPSBkYXRhWydjb21tZW50J10ucmVwbGFjZSgvOltcXFNdKzpbXFxTXSs6L2csJycpOyAvL3JlbW92ZSA6ZmllbGQ6ZGF0YTogaW5mb3JtYXRpb25cbiAgdmFyIHRleHQgPSBkYXRhWydjb21tZW50J10uc3BsaXQoJ1xcbicpO1xuICBkYXRhWydjb21tZW50J10gPSAnJztcbiAgZm9yICh2YXIgaT0wOyBpPHRleHQubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBsaW5lID0gdGV4dFtpXTtcbiAgICB2YXIgaW5pdFNwYWNlcyA9IGxpbmUuc2VhcmNoKC9cXFN8JC8pO1xuICAgIGZvciAodmFyIHByZWZpeEogPSAnJztwcmVmaXhKLmxlbmd0aDxNYXRoLnJvdW5kKGluaXRTcGFjZXMvMikqMjsgcHJlZml4Sis9JyAnKTsvL3N0ci5yZXBlYXQoaW50KSBkb2VzIG5vdCB3b3JrIGZvciBzb21lIHJlYXNvblxuICAgIGRhdGFbJ2NvbW1lbnQnXSArPSBwcmVmaXhKK2xpbmUudHJpbSgpKydcXG4nOyAgLy9kbyBub3QgcmVwbGFjZSBzcGFjZXMgaW5zaWRlIHRoZSBsaW5lXG4gIH1cbiAgZGF0YVsnY29tbWVudCddID0gZGF0YVsnY29tbWVudCddLnN1YnN0cmluZygwLCBkYXRhWydjb21tZW50J10ubGVuZ3RoLTEpO1xuICBpZiAodHlwZW9mIGRhdGFbJ3RhZ3MnXSA9PT0gJ3N0cmluZycgfHwgZGF0YVsndGFncyddIGluc3RhbmNlb2YgU3RyaW5nKSB7XG4gICAgZGF0YVsndGFncyddID0gZGF0YVsndGFncyddLnNwbGl0KCcgJyk7XG4gIH1cbiAgZGF0YVsndGFncyddPWRhdGFbJ3RhZ3MnXS5tYXAoZnVuY3Rpb24odil7XG4gICAgcmV0dXJuIHYudHJpbSgpO1xuICB9KTtcbiAgLy9pbmRpdmlkdWFsIHZlcmlmaWNhdGlvbiBvZiBkb2N1bWVudHNcbiAgaWYgKGRhdGFbJy10eXBlJ11bMF09PT0nc2FtcGxlJykge1xuICAgIGlmICghZGF0YS5xckNvZGUpIHtkYXRhWydxckNvZGUnXT1bXTt9XG4gICAgaWYgKHR5cGVvZiBkYXRhLnFyQ29kZSA9PT0gJ3N0cmluZycgfHwgZGF0YS5xckNvZGUgaW5zdGFuY2VvZiBTdHJpbmcpIHtcbiAgICAgIGRhdGEucXJDb2RlPWRhdGEucXJDb2RlLnNwbGl0KCcgJyk7XG4gICAgfVxuICB9XG4gIGlmIChkYXRhWyctdHlwZSddWzBdPT09J21lYXN1cmVtZW50Jykge1xuICAgIGlmICghZGF0YS5pbWFnZSkge2RhdGFbJ2ltYWdlJ109Jyc7fVxuICAgIGlmICghZGF0YS5zaGFzdW0pIHtkYXRhWydzaGFzdW0nXT0nJzt9XG4gIH1cbiAgLy9jbGVhbmluZyBhdCBlbmQgb2YgYWxsIGNoYW5nZXNcbiAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKGRhdGEpO1xuICBrZXlzLm1hcChmdW5jdGlvbihrZXkpe1xuICAgIGlmICh0eXBlb2YgZGF0YVtrZXldID09PSAnc3RyaW5nJyB8fCBkYXRhW2tleV0gaW5zdGFuY2VvZiBTdHJpbmcpIHtcbiAgICAgIGlmIChkYXRhW2tleV09PScnICYmIHByb3RlY3RlZEtleXMuaW5kZXhPZihrZXkpPT0tMSkge1xuICAgICAgICBkZWxldGUgZGF0YVtrZXldO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZGF0YVtrZXldID0gZGF0YVtrZXldLnRyaW0oKTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuICByZXR1cm4gZGF0YTtcbn1cblxuXG5mdW5jdGlvbiBvbnRvbG9neTJMYWJlbHMob250b2xvZ3ksIHRhYmxlRm9ybWF0KXtcbiAgLyoqXG4gICAqIEV4dHJhY3QgbGFiZWxzIGFuZCBjcmVhdGUgbGlzdHMgb2YgZG9jVHlwZSxkb2NMYWJlbCBwYWlyXG4gICAqIC0gdXNlZCBpbiBTdG9yZS5qcyBhbmQgZGF0YWJhc2UucHlcbiAgICogLSBkb2NMYWJlbCBpcyB0aGUgcGx1cmFsIGh1bWFuLXJlYWRhYmxlIGZvcm0gb2YgdGhlIGRvY1R5cGVcbiAgICogLSBkb2NUeXBlIGlzIHRoZSBzaW5nbGUtY2FzZSBub3VuXG4gICAqXG4gICAqIEFyZ3M6XG4gICAqICAgIG9udG9sb2d5OiBvbnRvbG9neVxuICAgKiAgICB0YWJsZUZvcm1hdDogdGFibGVGb3JtYXQgYnJhbmNoIGZyb20gLnBhc3RhRUxOLmpzb25cbiAgICpcbiAgICogUmV0dXJuczpcbiAgICogICAgZGljdGlvbmFyeTogZGF0YURpY3QsIGhpZXJhcmNoeURpY3RcbiAgICovXG4gIHZhciBkYXRhRGljdCA9IHt9O1xuICB2YXIgaGllcmFyY2h5RGljdCA9IHt9O1xuICBPYmplY3Qua2V5cyhvbnRvbG9neSkubWFwKCBmdW5jdGlvbihrZXkpe1xuICAgIGlmIChrZXk9PSdfaWQnIHx8IGtleT09J19yZXYnKVxuICAgICAgcmV0dXJuO1xuICAgIHZhciBsYWJlbCA9IG51bGw7XG4gICAgaWYgKGtleSBpbiB0YWJsZUZvcm1hdCAmJiAnLWxhYmVsLScgaW4gdGFibGVGb3JtYXRba2V5XSkgeyAgLy91c2UgZnJvbSB0YWJsZUZvcm1hdFxuICAgICAgbGFiZWwgPSB0YWJsZUZvcm1hdFtrZXldWyctbGFiZWwtJ107XG4gICAgfSBlbHNlIGlmIChrZXlbMF09PSd4JykgeyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy91c2UgZGVmYXVsdCBzdHJ1Y3R1cmFsIGVsZW1lbnRzXG4gICAgICBsYWJlbCA9IFsnUHJvamVjdHMnLCdUYXNrcycsJ1N1YnRhc2tzJywnU3Vic3VidGFza3MnXVtrZXlbMV1dO1xuICAgIH0gZWxzZSB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vZGVmYXVsdCBzeXN0ZW0gIHNhbXBsZS0+U2FtcGxlc1xuICAgICAgbGFiZWwgPSBrZXlbMF0udG9VcHBlckNhc2UoKStrZXkuc2xpY2UoMSkrJ3MnO1xuICAgIH1cbiAgICBpZiAoa2V5WzBdPT0neCcpXG4gICAgICBoaWVyYXJjaHlEaWN0W2tleV0gPSBsYWJlbDtcbiAgICBlbHNlXG4gICAgICBkYXRhRGljdFtrZXldID0gbGFiZWw7XG4gICAgcmV0dXJuO1xuICB9KTtcbiAgcmV0dXJuIHsnZGF0YURpY3QnOmRhdGFEaWN0LCAnaGllcmFyY2h5RGljdCc6aGllcmFyY2h5RGljdH07XG59XG5cblxuZnVuY3Rpb24gaGllcmFyY2h5MlN0cmluZyhkYXRhLCBhZGRJRCwgY2FsbGJhY2ssIGRldGFpbCwgbWFnaWNUYWdzKSB7XG4gIC8qKlxuICAgKiBDb252ZXJ0IGRpY3Rpb25hcnkgZm9yIGhpZXJhcmNoaWNhbCB0cmVlIGludG8gYSBzdHJpbmdcbiAgICogLSB1c2VkIGluIFN0b3JlLmpzIGFuZCBiYWNrZW5kLmpzXG4gICAqXG4gICAqIEFyZ3M6XG4gICAqICAgIGRhdGE6IGRpY3Rpb25hcnkgb2YgZW50cmllcyBmb3IgdGhpcyBwcm9qZWN0XG4gICAqICAgIGFkZElEOiBhZGQgZG9jLUlkIHRvIG91dHB1dFxuICAgKiAgICBjYWxsQmFjazogY2FsbGJhY2sgZnVuY3Rpb24gdG8gZ2V0IGRvY3VtZW50cyBmcm9tIGRhdGFiYXNlXG4gICAqICAgIGRldGFpbDogYW1vdW50IG9mIGRldGFpbCB0byBiZSBnaXZlblxuICAgKiAgICBtYWdpY1RhZ3M6IHRhZ3MgdG8gYmUgbW92ZWQgdG8gdGhlIGZyb250OyBvcmRlciBpbXBvcnRhbnQuLmxhc3QgYXJlIGFkZGVkIHRvIGZyb250XG4gICAqXG4gICAqIFJldHVybnM6XG4gICAqICAgIG9yZy1tb2RlIHN0cmluZyBvZiBoaWVyYXJjaHlcbiAgICovXG4gIHZhciBkYXRhTGlzdCA9IFtdO1xuICAvLyBhcnJhbmdlIHZhbHVlIGl0ZW1zIChoaWVyYXJjaHkpIGludG8gb3JkZXIgdGhhdCBjYW4gYmUgdXNlZCBmb3Igc29ydGluZ1xuICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoZGF0YSk7XG4gIHZhciBoaWVyU3RyaW5nID0gbnVsbDtcbiAgZm9yICh2YXIgaT0wOyBpPGtleXMubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBrZXkgPSBrZXlzW2ldO1xuICAgIGNvbnN0IHZhbHVlID0gZGF0YVtrZXldO1xuICAgIGlmICh2YWx1ZVswXT09PWtleSkgeyAvL3Byb2plY3Q6IHNpbXBsZSBoaWVyYXJjaHlcbiAgICAgIGhpZXJTdHJpbmcgPSBrZXk7XG4gICAgfSBlbHNlIHsgICAgICAgICAgICAgLy9lbHNlOiBjb21wbGljYXRlZCByZS1zdHJ1Y3R1cmluZ1xuICAgICAgdmFyIGhpZXJhcmNoeUlEcyA9IHZhbHVlWzBdLnNwbGl0KCcgJyk7XG4gICAgICBoaWVyU3RyaW5nID0gaGllcmFyY2h5SURzWzBdOyAgLy8gaW5pdGlhbGl6ZSBzdHJpbmdcbiAgICAgIGZvciAodmFyIGo9MTsgajxoaWVyYXJjaHlJRHMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgY29uc3QgaWQgPSBoaWVyYXJjaHlJRHNbal07XG4gICAgICAgIHZhciBjaGlsZE51bSA9IDA7XG4gICAgICAgIGlmIChpZCBpbiBkYXRhKSBjaGlsZE51bSA9IGRhdGFbaWRdWzFdO1xuICAgICAgICBpZiAoY2hpbGROdW0+OTk5OSkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCcqKkVSUk9SKiogY29tbW9uVG9vbHM6Q2hpbGROVU0+OTk5OSAqKkVSUk9SKiogJytrZXkpO1xuICAgICAgICB9XG4gICAgICAgIGhpZXJTdHJpbmcgKz0gJyAnKygnMDAnK2NoaWxkTnVtKS5zdWJzdHIoLTMpKycgJytpZDsgLy9jaGlsZE51bS1JRChwYWRkZWQgd2l0aCAwKSBJRFxuICAgICAgfVxuICAgICAgLy9oaWVyYXJjaHkgPSBoaWVyU3RyaW5nOyAvLysnICcrdmFsdWVbMV0udG9TdHJpbmcoKTtcbiAgICB9XG4gICAgLy8gYWRkIHRvIGRhdGEgbGlzdFxuICAgIGRhdGFMaXN0LnB1c2goe2hpZXJhcmNoeTpoaWVyU3RyaW5nLCBsYWJlbDp2YWx1ZS5zbGljZSgyKX0pO1xuICB9XG4gIC8vIHNvcnRpbmdcbiAgZnVuY3Rpb24gY29tcGFyZShhLGIpe1xuICAgIGlmIChhLmhpZXJhcmNoeT5iLmhpZXJhcmNoeSkgcmV0dXJuIDE7XG4gICAgZWxzZSAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTE7XG4gIH1cbiAgZGF0YUxpc3Quc29ydChjb21wYXJlKTtcblxuICAvL2NvbnNvbGUubG9nKGRhdGFMaXN0KTtcbiAgLy9uYXRpdmVWaWV3LCBhZGRJRD1GYWxzZSwgY2FsbGJhY2s9Tm9uZSwgZGV0YWlsPSdub25lJywgbWFnaWNUYWdzPU5vbmVcblxuICAvLyB1c2Ugc29ydGVkIGRhdGEgbGlzdCBhbmQgY3JlYXRlIHN0cmluZ1xuICB2YXIgb3V0U3RyaW5nID0gZGF0YUxpc3QubWFwKGZ1bmN0aW9uKGl0ZW0pe1xuICAgIGNvbnN0IGhpZXJhcmNoeUFycmF5ID0gaXRlbS5oaWVyYXJjaHkuc3BsaXQoJyAnKTtcbiAgICBjb25zdCBzcGFjZXMgPSBoaWVyYXJjaHlBcnJheS5sZW5ndGgvMi0wLjU7XG4gICAgZm9yICh2YXIgcHJlZml4ID0gJyc7cHJlZml4Lmxlbmd0aDw9c3BhY2VzOyBwcmVmaXgrPScqJyk7Ly9zdHIucmVwZWF0KGludCkgZG9lcyBub3Qgd29yayBmb3Igc29tZSByZWFzb25cbiAgICBpZiAoYWRkSUQ9PT10cnVlKSB7XG4gICAgICB2YXIgcGFydFN0cmluZyA9IGl0ZW0ubGFiZWxbMV07XG4gICAgICB2YXIgZG9jSUQgPSBoaWVyYXJjaHlBcnJheVtoaWVyYXJjaHlBcnJheS5sZW5ndGgtMV07XG4gICAgICBwYXJ0U3RyaW5nICs9ICd8fCcrZG9jSUQ7XG4gICAgICBpZiAodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKXtcbiAgICAgICAgdmFyIGRvYyA9IGNhbGxiYWNrKGRvY0lEKTtcbiAgICAgICAgaWYgKGRldGFpbD09PSdhbGwnKXtcbiAgICAgICAgICBmb3IgKHZhciBpPTA7IGk8ZG9jWyctYnJhbmNoJ10ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHBhcnRTdHJpbmcgKz0gJ1xcblBhdGg6ICcrZG9jWyctYnJhbmNoJ11baV0ucGF0aDtcbiAgICAgICAgICB9XG4gICAgICAgICAgcGFydFN0cmluZyArPSAnXFxuSW5oZXJpdGFuY2U6ICc7XG4gICAgICAgICAgZm9yICh2YXIgaTE9MDsgaTE8ZG9jWyctYnJhbmNoJ10ubGVuZ3RoOyBpMSsrKSB7XG4gICAgICAgICAgICBwYXJ0U3RyaW5nICs9IGRvY1snLWJyYW5jaCddW2kxXS5zdGFjaysnICc7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChkb2NbJy10eXBlJ109PVsneCcsJ3Byb2plY3QnXSkge1xuICAgICAgICAgIHBhcnRTdHJpbmcgKz0gJ1xcbk9iamVjdGl2ZTogJytkb2Mub2JqZWN0aXZlO1xuICAgICAgICB9XG4gICAgICAgIGZvciAodmFyIGkyPTA7IGkyPG1hZ2ljVGFncy5sZW5ndGg7IGkyKyspe1xuICAgICAgICAgIGlmIChkb2MudGFncy5pbmRleE9mKCcjJyttYWdpY1RhZ3NbaTJdKT4tMSl7XG4gICAgICAgICAgICBwcmVmaXggPSBwcmVmaXggKyAnICcrbWFnaWNUYWdzW2kyXTtcbiAgICAgICAgICAgIGZvciggdmFyIGkzID0gMDsgaTMgPCBkb2MudGFncy5sZW5ndGg7IGkzKyspe1xuICAgICAgICAgICAgICBpZiAoIGRvYy50YWdzW2kzXT09PScjJyttYWdpY1RhZ3NbaTJdKSB7XG4gICAgICAgICAgICAgICAgZG9jLnRhZ3Muc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgICAgIGktLTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBwYXJ0U3RyaW5nICs9ICdcXG5UYWdzOiAnK2RvYy50YWdzLmpvaW4oJyAnKSsnXFxuJytkb2MuY29tbWVudDtcbiAgICAgIH1cbiAgICAgIHBhcnRTdHJpbmcgPSBwcmVmaXgrJyAnKyBwYXJ0U3RyaW5nO1xuICAgIH0gZWxzZSB7XG4gICAgICBwYXJ0U3RyaW5nID0gcHJlZml4KycgJytpdGVtLmxhYmVsWzBdKyc6ICcraXRlbS5sYWJlbFsxXTtcbiAgICB9XG4gICAgcmV0dXJuIHBhcnRTdHJpbmc7XG4gIH0pO1xuICAvLyBlbmQgb2YgbWFwcGluZ1xuICByZXR1cm4gb3V0U3RyaW5nLmpvaW4oJ1xcbicpO1xufVxuXG5mdW5jdGlvbiBlZGl0U3RyaW5nMkRvY3ModGV4dCwgbWFnaWNUYWdzKSB7XG4gIC8qKlxuICAgKiBPcmctTW9kZSBzdHJpbmcgaW50byBsaXN0IG9mIGRvY3VtZW50c1xuICAgKiAtIHVzZWQgaW4gYmFja2VuZC5weVxuICAgKlxuICAgKiBBcmdzOlxuICAgKiAgICB0ZXh0OiBvcmctbW9kZSBzdHJpbmcgaW5jbC4gZG9jSURzXG4gICAqICAgIG1hZ2ljVGFnczogdGFncyB0byBiZSBtb3ZlZCB0byB0aGUgZnJvbnQ7IG9yZGVyIGltcG9ydGFudC4ubGFzdCBhcmUgYWRkZWQgdG8gZnJvbnRcbiAgICpcbiAgICogUmV0dXJuczpcbiAgICogICAgbGlzdCBvZiBkb2N1bWVudHMsIGRvY3VtZW50ID0gbGlzdCBvZiAnLW5ldy0nLHRpdGxlLG9iamVjdGl2ZSx0YWdzLGNvbW1lbnQsZG9jSUQsZG9jVHlwZVxuICAgKi9cbiAgdmFyIGRvY3MgPSBbXTtcbiAgdmFyIG9iamVjdGl2ZT1udWxsLCB0YWdzPW51bGwsIGNvbW1lbnQ9bnVsbCwgdGl0bGU9JycsIGRvY0lEPScnLCBkb2NUeXBlPScnO1xuICB0ZXh0ID0gdGV4dC5zcGxpdCgnXFxuJyk7XG4gIGZvciAodmFyIGk9MDsgaTx0ZXh0Lmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgbGluZSA9IHRleHRbaV07XG4gICAgaWYgKGxpbmUuc3Vic3RyaW5nKDAsMik9PT0nKiAnICAgfHxsaW5lLnN1YnN0cmluZygwLDMpPT09JyoqICcgICB8fGxpbmUuc3Vic3RyaW5nKDAsNCk9PT0nKioqICd8fFxuICAgICAgICBsaW5lLnN1YnN0cmluZygwLDUpPT09JyoqKiogJ3x8bGluZS5zdWJzdHJpbmcoMCw2KT09PScqKioqKiAnfHxsaW5lLnN1YnN0cmluZygwLDcpPT09JyoqKioqKiAnKXtcbiAgICAgIC8vIGZpbmlzaCB0aGlzIGVudHJ5XG4gICAgICBpZiAoY29tbWVudClcbiAgICAgICAgY29tbWVudCA9IGNvbW1lbnQudHJpbSgpOyAvL3JlbW92ZSB0cmFpbGluZyAvblxuICAgICAgdmFyIGRvY0kgPSB7Jy1uYW1lJzp0aXRsZSx0YWdzOnRhZ3MsY29tbWVudDpjb21tZW50LF9pZDpkb2NJRCwnLXR5cGUnOmRvY1R5cGV9O1xuICAgICAgaWYgKG9iamVjdGl2ZSlcbiAgICAgICAgZG9jSVsnb2JqZWN0aXZlJ10gPSBvYmplY3RpdmU7XG4gICAgICBpZiAodGl0bGU9PSctZGVsZXRlLScgJiYgZG9jSUQhPScnKSB7XG4gICAgICAgIGRvY0lbJ2VkaXQnXSA9ICctZGVsZXRlLSc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoZG9jSUQ9PScnKVxuICAgICAgICAgIGRvY0lbJ2VkaXQnXSA9ICctbmV3LSc7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICBkb2NJWydlZGl0J10gPSAnLWVkaXQtJztcbiAgICAgIH1cbiAgICAgIGlmIChkb2NJRCE9JycgfHwgdGl0bGUhPScnKVxuICAgICAgICBkb2NzLnB1c2goZG9jSSk7XG4gICAgICAvLyByZXNldCB2YXJpYWJsZXNcbiAgICAgIG9iamVjdGl2ZT1udWxsOyB0YWdzPW51bGw7IGNvbW1lbnQ9bnVsbDsgdGl0bGU9Jyc7IGRvY0lEPScnOyBkb2NUeXBlPScnO1xuICAgICAgLy8gZmlsbCBuZXcgc2V0XG4gICAgICBjb25zdCBwYXJ0cyA9IGxpbmUuc3BsaXQoJ3x8Jyk7XG4gICAgICB0aXRsZSA9IHBhcnRzWzBdLnNwbGl0KCcgJykuc2xpY2UoMSkuam9pbignICcpLnRyaW0oKTtcbiAgICAgIGZvciAodmFyIGo9bWFnaWNUYWdzLmxlbmd0aC0xOyBqPj0wOyBqLS0pe1xuICAgICAgICBpZiAodGl0bGUuc3Vic3RyaW5nKDAsNCk9PT1tYWdpY1RhZ3Nbal0pe1xuICAgICAgICAgIHRpdGxlID0gdGl0bGUuc2xpY2UobWFnaWNUYWdzW2pdLmxlbmd0aCsxKTtcbiAgICAgICAgICB0YWdzICs9ICcjJyttYWdpY1RhZ3Nbal0rJyAnO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAodGFncylcbiAgICAgICAgdGFncyA9IHRhZ3MudHJpbSgpO1xuICAgICAgaWYgKHBhcnRzLmxlbmd0aCA+MSkgZG9jSUQgPSBwYXJ0c1twYXJ0cy5sZW5ndGgtMV07XG4gICAgICBkb2NUeXBlID0gbGluZS5zcGxpdCgnICcpWzBdLmxlbmd0aC0xOyAgICAgICAgICAgICAgLy9udW1iZXIgb2YgKiBhdCB0aGUgYmVnaW5uaW5nIG9mIGxpbmVcbiAgICB9XG4gICAgZWxzZSBpZiAobGluZS5zdWJzdHJpbmcoMCwxMCk9PT0nT2JqZWN0aXZlOicpXG4gICAgICBvYmplY3RpdmUgPSBsaW5lLnN1YnN0cmluZygxMCxsaW5lLmxlbmd0aCkudHJpbSgpO1xuICAgIGVsc2UgaWYgKGxpbmUuc3Vic3RyaW5nKDAsNSkgPT09J1RhZ3M6JylcbiAgICAgIHRhZ3MgICAgICA9ICh0YWdzPT09bnVsbCkgICAgPyBsaW5lLnN1YnN0cmluZyg1LGxpbmUubGVuZ3RoKS50cmltKCkgOlxuICAgICAgICB0YWdzK2xpbmUuc3Vic3RyaW5nKDUsbGluZS5sZW5ndGgpLnRyaW0oKTtcbiAgICBlbHNlXG4gICAgaWYgKCAhKC9cXHxcXHxcXHctLy50ZXN0KGxpbmUpKSlcbiAgICAgIGNvbW1lbnQgICA9IChjb21tZW50PT09bnVsbCkgPyBsaW5lKydcXG4nIDogY29tbWVudCtsaW5lKydcXG4nO1xuICB9XG4gIC8vIGFmdGVyIGFsbCBkb25lLCBwcm9jZXNzIGxhc3QgZG9jdW1lbnRcbiAgaWYgKGNvbW1lbnQpXG4gICAgY29tbWVudCA9IGNvbW1lbnQudHJpbSgpO1xuICBkb2NJID0geyctbmFtZSc6dGl0bGUsdGFnczp0YWdzLGNvbW1lbnQ6Y29tbWVudCxfaWQ6ZG9jSUQsJy10eXBlJzpkb2NUeXBlfTtcbiAgaWYgKG9iamVjdGl2ZSlcbiAgICBkb2NJWydvYmplY3RpdmUnXSA9IG9iamVjdGl2ZTtcbiAgaWYgKHRpdGxlPT0nLWRlbGV0ZS0nICYmIGRvY0lEIT0nJykge1xuICAgIGRvY0lbJ2VkaXQnXSA9ICctZGVsZXRlLSc7XG4gIH0gZWxzZSB7XG4gICAgaWYgKGRvY0lEPT0nJylcbiAgICAgIGRvY0lbJ2VkaXQnXSA9ICctbmV3LSc7XG4gICAgZWxzZVxuICAgICAgZG9jSVsnZWRpdCddID0gJy1lZGl0LSc7XG4gIH1cbiAgZG9jcy5wdXNoKGRvY0kpO1xuICByZXR1cm4gZG9jcztcbn1cblxuXG5mdW5jdGlvbiBnZXRDaGlsZHJlbihkYXRhLGRvY0lEKXtcbiAgLyoqXG4gICAqIEdldCBkaXJlY3QgY2hpbGRyZW4gb2YgZG9jdW1lbnRcbiAgICogLSB1c2VkIGluIGJhY2tlbmQucHlcbiAgICpcbiAgICogQXJnczpcbiAgICogICAgZGF0YTogaGllcmFyY2hpY2FsIHRyZWUgaW4gb3JnLW1vZGUgZm9ybWF0XG4gICAqICAgIGRvY0lEOiBpZCBmb3IgcGFyZW50XG4gICAqXG4gICAqIFJldHVybnM6XG4gICAqICAgIGRpY3Rpb25hcnkgb2YgbmFtZXMgYW5kIGlkcyBvZiBkaXJlY3QgZmlyc3Qtb3JkZXIgY2hpbGRyZW5cbiAgICovXG4gIHZhciBuYW1lcyA9IFtdO1xuICB2YXIgaWRzICAgPSBbXTtcbiAgdmFyIHNhdmVMaW5lID0gZmFsc2U7XG4gIHZhciBudW1TdGFyc1BhcmVudCA9IC0xO1xuICBjb25zdCBsaW5lcyA9IGRhdGEuc3BsaXQoJ1xcbicpO1xuICBmb3IgKHZhciBpPTA7IGk8bGluZXMubGVuZ3RoOyBpKyspe1xuICAgIGNvbnN0IGl0ZW1zID0gbGluZXNbaV0uc3BsaXQoJ3x8Jyk7XG4gICAgaWYgKHNhdmVMaW5lKSB7XG4gICAgICBjb25zdCBuU3RhcnMgPSBpdGVtc1swXS5zcGxpdCgnICcpWzBdLmxlbmd0aDtcbiAgICAgIGlmIChuU3RhcnMgPT09IG51bVN0YXJzUGFyZW50KSBicmVhaztcbiAgICAgIGlmIChuU3RhcnMgPT09IG51bVN0YXJzUGFyZW50KzEpIHtcbiAgICAgICAgaWRzLnB1c2goaXRlbXNbMV0pO1xuICAgICAgICBuYW1lcy5wdXNoKGl0ZW1zWzBdLnN1YnN0cmluZyhudW1TdGFyc1BhcmVudCsyKSk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChpdGVtc1sxXT09PWRvY0lEKSB7XG4gICAgICBpZiAoaXRlbXNbMF1bMF09PT0nKicpIHtcbiAgICAgICAgbnVtU3RhcnNQYXJlbnQgPSBpdGVtc1swXS5zcGxpdCgnICcpLmxlbmd0aDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG51bVN0YXJzUGFyZW50ID0gMDtcbiAgICAgIH1cbiAgICAgIHNhdmVMaW5lID0gdHJ1ZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHtuYW1lczogbmFtZXMsIGlkczppZHN9O1xufVxuXG5cbmZ1bmN0aW9uIGNhbWVsQ2FzZShzdHIpIHtcbiAgLyoqXG4gICAqIFByb2R1Y2UgY2FtZWxDYXNlIGZyb20gbm9ybWFsIHN0cmluZ1xuICAgKiAgdXNlZCBpbiBiYWNrZW5kLnB5XG4gICAqL1xuICB2YXIgb3V0U3RyaW5nID0gc3RyLnJlcGxhY2UoLyg/Ol5cXHd8W0EtWl18XFxiXFx3fFxccyspL2csIGZ1bmN0aW9uKG1hdGNoKSB7XG4gICAgaWYgKC9cXHMrLy50ZXN0KG1hdGNoKSkgcmV0dXJuICcnOyAvLyBmb3Igd2hpdGUgc3BhY2VzXG4gICAgcmV0dXJuIG1hdGNoLnRvVXBwZXJDYXNlKCk7ICAgICAgIC8vIGVsc2UsIGluY2wuIG51bWJlcnNcbiAgfSk7XG4gIG91dFN0cmluZyA9IG91dFN0cmluZy5yZXBsYWNlKC9cXFcvZywnJyk7XG4gIHJldHVybiBvdXRTdHJpbmc7XG59XG5cblxuZXhwb3J0cy5maWxsRG9jQmVmb3JlQ3JlYXRlID0gZmlsbERvY0JlZm9yZUNyZWF0ZTtcbmV4cG9ydHMub250b2xvZ3kyTGFiZWxzID0gb250b2xvZ3kyTGFiZWxzO1xuZXhwb3J0cy5oaWVyYXJjaHkyU3RyaW5nID0gaGllcmFyY2h5MlN0cmluZztcbmV4cG9ydHMuZWRpdFN0cmluZzJEb2NzID0gZWRpdFN0cmluZzJEb2NzO1xuZXhwb3J0cy5nZXRDaGlsZHJlbiA9IGdldENoaWxkcmVuO1xuZXhwb3J0cy5jYW1lbENhc2UgPSBjYW1lbENhc2U7Il0sImZpbGUiOiJyZW5kZXJlci9jb21tb25Ub29scy5qcyJ9
